Format checkers
===============

Format checks report errors or problems in syntax and style of files.


AnyTextChecker
--------------

The AnyTextChecker class is a generic class that uses the rules from
the AnyTextMixin to check any text file.

    >>> from textwrap import dedent
    >>> from gdp.formatcheck import AnyTextChecker

    >>> text = dedent("""
    ...     This line is fine.
    ...     This line has trailing whitespace.  
    ...     <<<<<<< this line has a merge conflict.
    ...     This line exceeds 78 characters making it difficult to read: %s
    ...     """ % '0123456789abcdefghijklmnopqrstuvwxyz')
    >>> checker = AnyTextChecker('/path/to/file.txt', text)
    >>> checker.check()
    2: Line has trailing whitespace.
    3: File has conflicts.
    4: Line exceeds 78 characters.


XMLChecker
----------

The XMLChecker uses the AnyTextMixin to check for conflicts and trailing
whitespace.

    >>> from gdp.formatcheck import XMLChecker

    >>> text = dedent("""
    ...     <fine>well formed,</fine>
    ...     <!-- This line is fine.
    ...     This line has trailing whitespace.  
    ...     <<<<<<< this line has a merge conflict.
    ...     This line exceeds 78 characters which is fine: %s -->
    ...     """ % '0123456789abcdefghijklmnopqrstuvwxyz')
    >>> checker = XMLChecker('/path/to/file.xml', text)
    >>> checker.check()
    3: Line has trailing whitespace.
    4: File has conflicts.

XMLChecker reports ill-formed markup.

    >>> text = dedent("""
    ...     <outer>
    ...       outer text
    ...       <inner> not closed
    ...     </outer>
    ...     """)
    >>> checker = XMLChecker('/path/to/file.xml', text)
    >>> checker.check()
    5: mismatched tag

XMLChecker reports unknown html entities.

    >>> text = dedent("""
    ...     <outer>
    ...       outer text
    ...       &nbsp;
    ...     </outer>
    ...     """)
    >>> checker = XMLChecker('/path/to/file.xml', text)
    >>> checker.check()
    <BLANKLINE>

    >>> text = dedent("""
    ...     <outer>
    ...       outer text
    ...       &fnord;
    ...     </outer>
    ...     """)
    >>> checker = XMLChecker('/path/to/file.xml', text)
    >>> checker.check()
    4: undefined entity &fnord;


PythonChecker
-------------

PythonChecker uses pyflakes to check syntax. It will report errors like
a missing ':' in a function declaration.

    >>> from tempfile import NamedTemporaryFile
    >>> from gdp.formatcheck import PythonChecker

    >>> text = dedent("""
    ...     def test_function()
    ...         x = undeclared_var
    ...     """)
    >>> temp_file = NamedTemporaryFile(prefix='test', suffix='.py')
    >>> checker = PythonChecker(temp_file.name, text)
    >>> checker.check()
    2: Could not compile offset 20: def test_function()

    >>> temp_file.close()

PythonChecker will report warning like unused imports and undefined names.

    >>> text = dedent("""
    ...     import os
    ...     def test_function():
    ...         x = undefined_var
    ...     """)
    >>> temp_file = NamedTemporaryFile(prefix='test', suffix='.py')
    >>> checker = PythonChecker(temp_file.name, text)
    >>> checker.check()
    4: undefined name 'undefined_var'
    2: 'os' imported but unused

    >>> temp_file.close()

PythonChecker uses pep8 to check style.

    >>> text = dedent("""
    ...     CONSTANT = 'constant'
    ...     def testFunction():
    ...         x =  'extra space'
    ...         y = 'trailing whitespace'  
    ...     """)
    >>> temp_file = NamedTemporaryFile(prefix='test', suffix='.py')
    >>> temp_file.file.write(text)
    >>> temp_file.file.flush()
    >>> checker = PythonChecker(temp_file.name, text)
    >>> checker.check()
    3: E302 expected 2 blank lines, found 0
    4: E222 multiple spaces after operator
    5: W291 trailing whitespace

    >>> temp_file.close()
